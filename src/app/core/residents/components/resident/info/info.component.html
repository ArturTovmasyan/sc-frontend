<nz-spin [nzSpinning]="loading">
  <div *ngIf="resident">
    <div nz-row>
      <div nz-col [nzSpan]="24">
        <div class="text-center m-0">
          <div class="resident-photo">
            <img *ngIf="!resident.photo" src="/assets/img/person_placeholder.png" class="img-thumbnail"
                 style="max-height: 25rem"/>
            <img *ngIf="resident.photo" src="{{ resident.photo }}" class="img-thumbnail"
                 style="max-height: 25rem"
                 alt="{{ residen|resident }}" title="{{ resident|resident }}"/>
            <div *ngIf="resident.photo" class="edit">
              <button nz-button nzType="primary" (click)="show_modal_image_editor();"><i class="fas fa-pencil-alt"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div nz-row>
      <div nz-col [nzSpan]="24">
        <p class="text-center m-1">
          <strong style="font-size: large;">{{ resident.salutation.title }} {{ resident.first_name }} {{ resident.middle_name }} {{ resident.last_name }}</strong>
        </p>
      </div>
    </div>

    <div nz-row [nzGutter]="4">
      <div nz-col [nzSpan]="8" class="text-right"><strong>Birthday:</strong></div>
      <div nz-col [nzSpan]="16">{{ resident.birthday|date }}
        ({{ today | amDifference: resident.birthday :'years' : false }} years)
      </div>
    </div>

    <div nz-row [nzGutter]="4">
      <div nz-col [nzSpan]="8" class="text-right"><strong>Gender:</strong></div>
      <div nz-col [nzSpan]="16">{{ resident.gender|gender }}</div>
    </div>

    <div nz-row [nzGutter]="4">
      <div nz-col [nzSpan]="24"><strong>Phone Numbers:</strong></div>
      <div nz-col [nzOffset]="4" [nzSpan]="20">
        <div nz-row [nzGutter]="4" *ngFor="let phone of resident.phones">
          <div nz-col [nzSpan]="6" class="text-right"><strong>{{ phone.type|phone_type }}:</strong></div>
          <div nz-col [nzSpan]="12">
            <a href="tel:{{ phone.number| mask: '(000) 000-0000' }}">{{ phone.number| mask: '(000) 000-0000' }}</a>
            <ng-container *ngIf="phone.extension">, ext. {{ phone.extension }}</ng-container>
          </div>
          <div *ngIf="phone.primary" nz-col [nzSpan]="2">
            <i class="fas fa-key" title="Primary"></i>
          </div>
          <div *ngIf="phone.sms_enabled" nz-col [nzSpan]="2">
            <i class="fas fa-sms" title="SMS Enabled"></i>
          </div>
        </div>
      </div>
    </div>

    <ng-container *ngIf="contract" [ngSwitch]="contract.type">
      <div nz-row [nzGutter]="4">
        <div nz-col [nzSpan]="8" class="text-right"><strong>Date admitted:</strong></div>
        <div nz-col [nzSpan]="16">{{ contract.start|date }}</div>
      </div>

      <div nz-row [nzGutter]="4">
        <div nz-col [nzSpan]="8" class="text-right"><strong>State:</strong></div>
        <div nz-col [nzSpan]="16">{{ contract.option.state|contract_state }}</div>
      </div>

      <template *ngSwitchCase="ResidentType.FACILITY"
                [ngTemplateOutletContext]="{ option: contract.option }" [ngTemplateOutlet]="tplFacility">
      </template>
      <template *ngSwitchCase="ResidentType.APARTMENT"
                [ngTemplateOutletContext]="{ option: contract.option }" [ngTemplateOutlet]="tplApartment">
      </template>
      <template *ngSwitchCase="ResidentType.REGION"
                [ngTemplateOutletContext]="{ option: contract.option }" [ngTemplateOutlet]="tplRegion">
      </template>
    </ng-container>

    <nz-divider></nz-divider>

    <div class="d-flex">
      <nz-button-group [nzSize]="'medium'" class="ml-auto">
        <button nz-button nzType="primary" (click)="show_modal_add(); $event.preventDefault();">
          <i nz-icon type="plus"></i> {{ "grid.add"|translate }}
        </button>
        <button nz-button nzType="default" [nzLoading]="loading_edit_modal"
                (click)="show_modal_edit(); $event.preventDefault();">
          <i nz-icon type="edit"></i> {{ "grid.edit"|translate }}
        </button>
        <button nz-button nzType="danger" (click)="show_modal_remove(); $event.preventDefault();">
          <i nz-icon type="delete"></i> {{ "grid.remove"|translate }}
        </button>
      </nz-button-group>
      <nz-button-group *ngIf="contract" [nzSize]="'medium'" class="ml-auto">
        <button nz-button nzType="default" (click)="show_modal_move(); $event.preventDefault();">
          <i nz-icon type="swap"></i> {{ "grid.move"|translate }}
        </button>
      </nz-button-group>
    </div>
  </div>
</nz-spin>

<ng-template #tplFacility let-option="option">
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Care Group:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.care_group }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Care Level:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.care_level.title }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Ambulatory:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.ambulatory }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>DNR:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.dnr }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>POLST:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.polst }}</div>
  </div>

  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Dinning Room:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.dining_room.title }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Room/Bed:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.bed.room.number }} ({{ option.bed.number }})</div>
  </div>
</ng-template>

<ng-template #tplApartment let-option="option">
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Room/Bed:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.bed.room.number }} ({{ option.bed.number }})</div>
  </div>
</ng-template>

<ng-template #tplRegion let-option="option">
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Care Group:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.care_group }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Care Level:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.care_level.title }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Ambulatory:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.ambulatory }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>DNR:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.dnr }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>POLST:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.polst }}</div>
  </div>

  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>CSZ:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.street_address }}</div>
  </div>
  <div nz-row [nzGutter]="4">
    <div nz-col [nzSpan]="8" class="text-right"><strong>Street Address:</strong></div>
    <div nz-col [nzSpan]="16">{{ option.csz|csz }}</div>
  </div>
</ng-template>


